# ğŸ¯ Jarvis Hotword System Architecture & Flow Diagrams

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         JARVIS HOTWORD SYSTEM                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚                        run.py (Launcher)                           â”‚
â”‚                            â”‚                                       â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚         â”‚                  â”‚                  â”‚                   â”‚
â”‚    Process 1           IPC Queue         Process 2                â”‚
â”‚    (Main GUI)      (activation signal)   (Hotword)               â”‚
â”‚         â”‚                  â”‚                  â”‚                   â”‚
â”‚         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                   â”‚
â”‚         â”‚             â–¼    â”‚    â–¼             â”‚                   â”‚
â”‚      main.py     "activate_"  engine/        â”‚                   â”‚
â”‚         â”‚         jarvis"     features.py    â”‚                   â”‚
â”‚         â”‚                                     â”‚                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”                        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”              â”‚
â”‚    â”‚          â”‚                        â”‚            â”‚              â”‚
â”‚    â–¼          â–¼                        â–¼            â–¼              â”‚
â”‚  GUI      Commands              Porcupine      PyAudio           â”‚
â”‚  â”‚         â”‚                     Module        (Microphone)       â”‚
â”‚  â”‚         â””â”€â–ºhotword_listener   â”‚              â”‚                â”‚
â”‚  â”‚            _thread()          â”œâ”€â–ºProcess    â”œâ”€â–ºRead Frames   â”‚
â”‚  â”‚            â”‚                  â”‚ Audio       â”‚                â”‚
â”‚  â”‚            â”œâ”€â–ºplay_            â”‚         â”Œâ”€â”€â”´â”€â”€â”             â”‚
â”‚  â”‚            â”‚  activation_      â”‚         â–¼     â”‚             â”‚
â”‚  â”‚            â”‚  beep()           â”‚    Wake Word  â”‚             â”‚
â”‚  â”‚            â”‚                   â”‚    Detected?  â”‚             â”‚
â”‚  â”‚            â”œâ”€â–ºspeak()          â”‚         â”‚     â”‚             â”‚
â”‚  â”‚            â”‚                   â”‚         â–¼     â”‚             â”‚
â”‚  â”‚            â””â”€â–ºlisten_          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚             â”‚
â”‚  â”‚               from_frontend()  â”‚    â”‚ Send    â”‚â”‚             â”‚
â”‚  â”‚                                â”‚    â”‚ "activateâ”‚â”‚             â”‚
â”‚  â”‚                                â”‚    â”‚ _jarvis"â”‚â”‚             â”‚
â”‚  â”‚                                â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â”‚             â”‚
â”‚  â”‚                                â”‚         â”‚     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚     â”‚             â”‚
â”‚                   â”‚                          â”‚     â”‚             â”‚
â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Activation Flow Sequence

```
Timeline: Say "Jarvis" â†’ Command Execution â†’ Return to Listening

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚ 1. PASSIVE LISTENING (Continuous)                                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚    â”‚ Process 2: Hotword Listener         â”‚                             â”‚
â”‚    â”‚ - Reading microphone frames         â”‚                             â”‚
â”‚    â”‚ - Comparing with Porcupine model    â”‚                             â”‚
â”‚    â”‚ - Listening for "Jarvis"            â”‚                             â”‚
â”‚    â”‚ - CPU: 2-5%, Latency: ~32ms/frame  â”‚                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚              â”‚                                                          â”‚
â”‚              â”‚ User says "Jarvis" detected                              â”‚
â”‚              â–¼                                                          â”‚
â”‚                                                                          â”‚
â”‚ 2. WAKE WORD DETECTED                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚    â”‚ Process 2:                          â”‚                             â”‚
â”‚    â”‚ - Wake word match found             â”‚                             â”‚
â”‚    â”‚ - Start COOLDOWN (2 seconds)        â”‚                             â”‚
â”‚    â”‚ - Send "activate_jarvis" signal     â”‚                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚              â”‚                                                          â”‚
â”‚              â”‚ Signal via IPC Queue                                    â”‚
â”‚              â–¼                                                          â”‚
â”‚                                                                          â”‚
â”‚ 3. ACTIVATION IN MAIN PROCESS                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚    â”‚ Process 1: hotword_listener_thread()â”‚                             â”‚
â”‚    â”‚ - Receives "activate_jarvis" signal â”‚                             â”‚
â”‚    â”‚ - play_activation_beep() [100ms]    â”‚                             â”‚
â”‚    â”‚ - beep: 880Hz sine wave             â”‚                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚              â”‚                                                          â”‚
â”‚              â–¼ (after beep completes)                                   â”‚
â”‚                                                                          â”‚
â”‚ 4. USER PROMPT                                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚    â”‚ speak("Yes, how can I help you?")   â”‚                             â”‚
â”‚    â”‚ - Uses gTTS/pygame for audio        â”‚                             â”‚
â”‚    â”‚ - Displays in UI                    â”‚                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚              â”‚                                                          â”‚
â”‚              â–¼                                                          â”‚
â”‚                                                                          â”‚
â”‚ 5. COMMAND LISTENING                                                   â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚    â”‚ listen_from_frontend()              â”‚                             â”‚
â”‚    â”‚ - Captures user speech              â”‚                             â”‚
â”‚    â”‚ - Converts to text (Google STT)     â”‚                             â”‚
â”‚    â”‚ - Example: "open google"            â”‚                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚              â”‚                                                          â”‚
â”‚              â–¼                                                          â”‚
â”‚                                                                          â”‚
â”‚ 6. COMMAND PROCESSING                                                  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚    â”‚ processCommand(command)             â”‚                             â”‚
â”‚    â”‚ - Existing pipeline (unchanged)     â”‚                             â”‚
â”‚    â”‚ - Example: opens google.com         â”‚                             â”‚
â”‚    â”‚ - May handle complex multi-step     â”‚                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚              â”‚                                                          â”‚
â”‚              â–¼                                                          â”‚
â”‚                                                                          â”‚
â”‚ 7. RETURN TO PASSIVE LISTENING                                         â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚    â”‚ listen_from_frontend() loop ends    â”‚                             â”‚
â”‚    â”‚ Process 2: Cooldown expires         â”‚                             â”‚
â”‚    â”‚ - Ready for next "Jarvis"           â”‚                             â”‚
â”‚    â”‚ - Back to step 1                    â”‚                             â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Timing:
  0ms    User says "Jarvis"
  32ms   Porcupine processes frame
  100ms  Wake word detected
  200ms  Activate_jarvis signal sent
  250ms  Beep starts
  350ms  Beep ends
  400ms  "Yes, how can I help you?" spoken
  2000ms Cooldown expires (ready for next activation)
```

## Process Communication Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PROCESS 1 (Main Jarvis)    â”‚         â”‚    PROCESS 2 (Hotword Listen)   â”‚
â”‚                                 â”‚         â”‚                                 â”‚
â”‚  hotword_listener_thread()      â”‚         â”‚  hotword(command_queue)         â”‚
â”‚  â”œâ”€ Monitor queue.get()         â”‚         â”‚  â”œâ”€ Initialize Porcupine        â”‚
â”‚  â”‚  timeout=1                   â”‚         â”‚  â”œâ”€ Open PyAudio stream         â”‚
â”‚  â”‚                              â”‚         â”‚  â””â”€ Loop:                       â”‚
â”‚  â”‚  while True:                 â”‚         â”‚     â”œâ”€ Read frame              â”‚
â”‚  â”‚  â”œâ”€ Try msg = queue.get()    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Process with model       â”‚
â”‚  â”‚  â”‚  if msg == "activate":    â”‚         â”‚     â”œâ”€ Check keyword_index     â”‚
â”‚  â”‚  â”‚  â”œâ”€ play_activation_beep()â”‚         â”‚     â”œâ”€ If detected:           â”‚
â”‚  â”‚  â”‚  â”œâ”€ time.sleep(0.3)       â”‚         â”‚     â”‚  â””â”€ queue.put(msg) â”€â”€â”€â”€â–ºâ”‚
â”‚  â”‚  â”‚  â”œâ”€ speak("Yes...")       â”‚         â”‚     â””â”€ If cooldown: skip      â”‚
â”‚  â”‚  â”‚  â””â”€ listen_from_frontend()â”‚         â”‚                                 â”‚
â”‚  â”‚  â”œâ”€ except queue.Empty:      â”‚         â”‚  Cooldown timer:               â”‚
â”‚  â”‚  â”‚  pass                     â”‚         â”‚  â”œâ”€ On detection:              â”‚
â”‚  â”‚  â””â”€ time.sleep(0.1)          â”‚         â”‚  â”‚  last_activation = now()    â”‚
â”‚  â”‚                              â”‚         â”‚  â””â”€ On next detection:         â”‚
â”‚  â””â”€ End of monitoring loop      â”‚         â”‚     if now - last < 2s:        â”‚
â”‚                                 â”‚         â”‚      ignore detection          â”‚
â”‚                                 â”‚         â”‚     else:                      â”‚
â”‚                                 â”‚         â”‚      send signal               â”‚
â”‚                                 â”‚         â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â–²                                            â”‚
       â”‚           IPC Queue                       â”‚
       â”‚      "activate_jarvis"                    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         (via multiprocessing.Queue)
```

## Audio Processing Pipeline

```
Microphone Hardware (PCM Audio)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PyAudio InputStream              â”‚
â”‚   â”œâ”€ Sample Rate: 16000 Hz         â”‚
â”‚   â”œâ”€ Channels: 1 (Mono)            â”‚
â”‚   â”œâ”€ Format: paInt16 (16-bit)      â”‚
â”‚   â””â”€ Frame Size: 512 samples       â”‚
â”‚      (32ms at 16kHz)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frame Buffer                     â”‚
â”‚   512 PCM samples                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Porcupine.process()              â”‚
â”‚   â”œâ”€ Input: PCM frame              â”‚
â”‚   â”œâ”€ Model: Jarvis.ppn             â”‚
â”‚   â””â”€ Output: keyword_index         â”‚
â”‚      (0=detected, -1=not detected) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€ If keyword_index >= 0:
         â”‚       queue.put("activate_jarvis")
         â”‚
         â””â”€ If keyword_index == -1:
                  continue listening
```

## Cooldown State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     PASSIVE LISTENING               â”‚
â”‚     (Ready for detection)           â”‚
â”‚     last_activation = None          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ "Jarvis" detected
          â”‚ keyword_index >= 0
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     DETECTED                        â”‚
â”‚     â”œâ”€ Check cooldown expired       â”‚
â”‚     â”‚  (now - last_activation > 2s) â”‚
â”‚     â”‚                               â”‚
â”‚     â”œâ”€ If YES:                      â”‚
â”‚     â”‚  â”œâ”€ queue.put("activate_")    â”‚
â”‚     â”‚  â””â”€ last_activation = now()   â”‚
â”‚     â”‚                               â”‚
â”‚     â””â”€ If NO:                       â”‚
â”‚        â””â”€ Print "Cooldown active"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ Resume listening
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     COOLDOWN ACTIVE (2s)            â”‚
â”‚     â”œâ”€ Ignore further detections    â”‚
â”‚     â”œâ”€ Wait timer to expire         â”‚
â”‚     â””â”€ time_remaining = 2 - elapsed â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ 2 seconds elapsed
          â”‚ now - last_activation >= 2s
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     PASSIVE LISTENING               â”‚
â”‚     (Ready for next detection)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Start hotword(command_queue)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Try:                                    â”‚
â”‚  â”œâ”€ Initialize Porcupine                 â”‚
â”‚  â”œâ”€ Open PyAudio stream                  â”‚
â”‚  â”œâ”€ Process audio frames (while loop)    â”‚
â”‚  â””â”€ Handle exceptions                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚         â”‚              â”‚
    â–¼         â–¼         â–¼              â–¼
FileNotFound ImportError Exception    Success
    â”‚         â”‚         â”‚              â”‚
    â”‚         â”‚         â”‚              â–¼
    â”‚         â”‚         â”‚         Normal Loop
    â”‚         â”‚         â”‚         Continue
    â”‚         â”‚         â”‚         Process...
    â–¼         â–¼         â–¼
 Exit(1)   Exit(1)   Print +        
                    Continue

Finally (Cleanup):
â”œâ”€ Close audio stream
â”œâ”€ Terminate PyAudio
â”œâ”€ Delete Porcupine
â””â”€ Print shutdown message
```

## Beep Sound Generation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  play_activation_beep()                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Initialize Pygame mixer                â”‚
â”‚  pygame.mixer.init()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate sine wave:                    â”‚
â”‚  â”œâ”€ Frequency: 880 Hz (A5 note)        â”‚
â”‚  â”œâ”€ Duration: 0.15s                     â”‚
â”‚  â”œâ”€ Sample rate: 44100 Hz               â”‚
â”‚  â”œâ”€ Samples: 0.15 Ã— 44100 = 6615       â”‚
â”‚  â””â”€ Wave: sin(2Ï€ Ã— freq Ã— t)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Apply fade:                            â”‚
â”‚  â”œâ”€ Fade in: 0-10ms                     â”‚
â”‚  â”‚  (prevents click)                    â”‚
â”‚  â”œâ”€ Middle: 10-140ms                    â”‚
â”‚  â”‚  (full amplitude)                    â”‚
â”‚  â””â”€ Fade out: 140-150ms                 â”‚
â”‚     (prevents click)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Convert to 16-bit PCM stereo            â”‚
â”‚  â””â”€ Duplicate for both L/R channels     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Play via pygame.sndarray.make_sound()  â”‚
â”‚  sound.play()                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Return True (success)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Metrics & Thresholds

| Component | Parameter | Value | Unit |
|-----------|-----------|-------|------|
| **Audio** | Sample Rate | 16000 | Hz |
| | Frame Size | 512 | samples |
| | Frame Duration | 32 | ms |
| | Channels | 1 | (mono) |
| **Porcupine** | Model | Jarvis | .ppn |
| | Accuracy | 98+ | % |
| | Latency | <100 | ms |
| **Cooldown** | Duration | 2 | seconds |
| | On Detection | Auto-start | |
| **Beep** | Frequency | 880 | Hz |
| | Duration | 150 | ms |
| | Fade in/out | 10 | ms each |
| **Process** | IPC Type | Queue | |
| | Queue Timeout | 1 | second |
| | Thread Sleep | 0.1 | second |
| **Performance** | CPU (idle) | 2-5 | % |
| | CPU (detect) | 8-12 | % |
| | Memory | 50-80 | MB |

---

## State Diagram - Main Loop

```
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Jarvis Started             â”‚
      â”‚  jarvis_active = False      â”‚
      â”‚  is_listening = False       â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Waiting for Hotword        â”‚
      â”‚  Background Process 2       â”‚
      â”‚  monitors queue             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ "Jarvis" detected
                   â”‚ & signal received
                   â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Activation                 â”‚
      â”‚  â”œâ”€ Play beep               â”‚
      â”‚  â”œâ”€ Speak prompt            â”‚
      â”‚  â””â”€ Start listen_from_front â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Listening for Command      â”‚
      â”‚  User speaks command        â”‚
      â”‚  STT converts to text       â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Processing Command         â”‚
      â”‚  processCommand()           â”‚
      â”‚  Existing pipeline          â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Command Complete           â”‚
      â”‚  Auto-return to listening   â”‚
      â”‚  (listen_from_frontend()    â”‚
      â”‚   loop ends)                â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚  Ready for Next Wake Word   â”‚
      â”‚  Back to passive listening  â”‚
      â”‚  (Process 2 continues)      â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â””â”€â”€â–º [Loop back to "Waiting"]
```

---

**Diagram Version:** 1.0  
**Last Updated:** January 2026
